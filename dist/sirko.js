!function(){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var r,t=(function(r){var t,n,i,o,s,c,a,u,l,d,f,h,p,v,w,b,g,P,y;t=e,n=/iPhone/i,i=/iPod/i,o=/iPad/i,s=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,c=/Android/i,a=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,u=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,l=/Windows Phone/i,d=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,f=/BlackBerry/i,h=/BB10/i,p=/Opera Mini/i,v=/(CriOS|Chrome)(?=.*\bMobile\b)/i,w=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,b=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),g=function(e,r){return e.test(r)},P=function(e){var r=e||navigator.userAgent,t=r.split("[FBAN");if(void 0!==t[1]&&(r=t[0]),void 0!==(t=r.split("Twitter"))[1]&&(r=t[0]),this.apple={phone:g(n,r),ipod:g(i,r),tablet:!g(n,r)&&g(o,r),device:g(n,r)||g(i,r)||g(o,r)},this.amazon={phone:g(a,r),tablet:!g(a,r)&&g(u,r),device:g(a,r)||g(u,r)},this.android={phone:g(a,r)||g(s,r),tablet:!g(a,r)&&!g(s,r)&&(g(u,r)||g(c,r)),device:g(a,r)||g(u,r)||g(s,r)||g(c,r)},this.windows={phone:g(l,r),tablet:g(d,r),device:g(l,r)||g(d,r)},this.other={blackberry:g(f,r),blackberry10:g(h,r),opera:g(p,r),firefox:g(w,r),chrome:g(v,r),device:g(f,r)||g(h,r)||g(p,r)||g(w,r)||g(v,r)},this.seven_inch=g(b,r),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},y=function(){var e=new P;return e.Class=P,e},r.exports&&"undefined"==typeof window?r.exports=P:r.exports&&"undefined"!=typeof window?r.exports=y():t.isMobile=y()}(r={exports:{}},r.exports),r.exports),n={call:function(e){return!new t.Class(e.request.agent).any&&e}},i={call:function(e){return navigator.serviceWorker.register("sirko_sw.js"),navigator.serviceWorker.ready.then(function(r){return e.serviceWorker=r.active,Promise.resolve(e)})}},o={call:function(e){var r=e.request.referrer,t=new RegExp("^http(s)?://"+e.request.domain);return r&&!t.test(r)&&(r=null),e.request.referrer=r,e}},s={call:function(e){var r=e.request,t=new RegExp("^http(s)?://"+r.domain+"(.*)?/");return r.currentPath=r.currentUrl.replace(t,"/"),r.referrer&&(r.referrer=r.referrer.replace(t,"/")),e}},c=window.sessionStorage,a=function(e,r){"object"==typeof r&&(r=JSON.stringify(r)),c.setItem(e,r)},u=function(e){var r=c.getItem(e);if(r)return"{"===r.charAt(0)&&(r=JSON.parse(r)),r},l=function(e,r){var t=c.getItem(e);t&&c.setItem(r,t)},d={call:function(e){return u("lastPredictionFor")!==e.request.currentPath&&e}},f=function(){Promise.all([caches.open("sirko-prefetch"),caches.open("sirko-offline")]).then(function(e){var r=e[0],t=e[1];r.keys().then(function(e){e.forEach(function(e){r.match(e).then(function(r){return t.put(e,r)}).then(function(){r.delete(e)})})})})},h=function(e,r){caches.open("sirko-prefetch").then(function(t){!function(e,r){r.forEach(function(r){e.add(new Request(r.path,{credentials:"include",redirect:"follow"}))})}(t,e),function(e,r){r.forEach(function(r){e.add(r)})}(t,r)})},p=function(){return caches.delete("sirko-prefetch")};var v={call:function(e,r){return r.offline?f():p(),e}},w={call:function(e){var r=Array.prototype.slice.call(document.querySelectorAll('link[rel="stylesheet"]')).map(function(e){return e.href});return Array.prototype.slice.call(document.querySelectorAll("script[src]")).forEach(function(e){r.push(e.src)}),e.request.assets=r,e}},b={call:function(e,r){var t=e.request;return new Promise(function(n,i){var o=new MessageChannel;o.port1.onmessage=function(r){r.data.isStateModified&&(t.referrer=null),n(e)},e.serviceWorker.postMessage({referrer:t.referrer,currentUrl:t.currentUrl,domain:t.domain,engineUrl:r.engineUrl},[o.port2])})}},g=function(e){this.engineUrl=e,this.xhr=new XMLHttpRequest};g.prototype.predict=function(e){var r=this;return new Promise(function(t){r._makePrediction(e,t)})},g.prototype._makePrediction=function(e,r){var t=this;this.xhr.withCredentials=!0,this.xhr.open("POST",this.engineUrl),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.onload=function(){r(JSON.parse(t.xhr.response))},this.xhr.send(this._requestBody(e))},g.prototype._requestBody=function(e){var r={current:e.currentPath,assets:e.assets};return e.referrerPath&&(r.referrer=e.referrerPath),JSON.stringify(r)};var P={pipes:[n,i,o,b,s,d,v,w,{call:function(e,r){if(e.prediction)return e;var t=new g(r.engineUrl),n=e.request;return t.predict({currentPath:n.currentPath,referrerPath:n.referrer,assets:n.assets}).then(function(r){return e.prediction=r,Promise.resolve(e)})}},{call:function(e){var r=e.prediction.pages,t=e.prediction.assets;return r.length&&h(r,t),e}},{call:function(e){return l("lastPrediction","prevPrediction"),a("lastPrediction",e.prediction),a("lastPredictionFor",e.request.currentPath),e}},{call:function(e){var r,t=u("prevPrediction"),n=e.prediction;return t&&t.pages.length&&(r=t.pages.findIndex(function(r){return r.path===e.request.currentPath})>-1),[n.pages,r]}}],call:function(e,r){var t=Promise.resolve({request:e});return this.pipes.forEach(function(e){t=t.then(function(t){return(t=e.call(t,r))?Promise.resolve(t):Promise.reject()})}),t}},y=function(e,r){return r.engineUrl=r.engineUrl+"/predict",P.call(e,r)},m=window.sirko;if("serviceWorker"in navigator&&m){var A={agent:window.navigator.userAgent,referrer:document.referrer,currentUrl:window.location.href,domain:document.domain},x={};m.q.forEach(function(e){var r=e[0],t=e[1];x[r]=t}),window.sirko=function(e,r){x.prediction&&"predicted"===e?r.apply(this,x.prediction):x[e]=r},y(A,x).then(function(e){try{var r=x.predicted;r&&r.apply(r,e),x.prediction=e}catch(e){console.error(e)}}).catch(function(){var e=x.rejected;e&&e.apply(e)})}}();

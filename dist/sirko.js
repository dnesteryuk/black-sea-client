!function(){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=function(e,r){return r={exports:{}},e(r,r.exports),r.exports}(function(r){!function(e){var t=/iPhone/i,n=/iPod/i,i=/iPad/i,o=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,s=/Android/i,c=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,a=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,u=/Windows Phone/i,l=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,d=/BlackBerry/i,p=/BB10/i,h=/Opera Mini/i,f=/(CriOS|Chrome)(?=.*\bMobile\b)/i,v=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,w=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),b=function(e,r){return e.test(r)},P=function(e){var r=e||navigator.userAgent,P=r.split("[FBAN");if(void 0!==P[1]&&(r=P[0]),void 0!==(P=r.split("Twitter"))[1]&&(r=P[0]),this.apple={phone:b(t,r),ipod:b(n,r),tablet:!b(t,r)&&b(i,r),device:b(t,r)||b(n,r)||b(i,r)},this.amazon={phone:b(c,r),tablet:!b(c,r)&&b(a,r),device:b(c,r)||b(a,r)},this.android={phone:b(c,r)||b(o,r),tablet:!b(c,r)&&!b(o,r)&&(b(a,r)||b(s,r)),device:b(c,r)||b(a,r)||b(o,r)||b(s,r)},this.windows={phone:b(u,r),tablet:b(l,r),device:b(u,r)||b(l,r)},this.other={blackberry:b(d,r),blackberry10:b(p,r),opera:b(h,r),firefox:b(v,r),chrome:b(f,r),device:b(d,r)||b(p,r)||b(h,r)||b(v,r)||b(f,r)},this.seven_inch=b(w,r),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},g=function(){var e=new P;return e.Class=P,e};r.exports&&"undefined"==typeof window?r.exports=P:r.exports&&"undefined"!=typeof window?r.exports=g():e.isMobile=g()}(e)}),t={call:function(e){return!new r.Class(e.request.agent).any&&e}},n={call:function(e){return caches.delete("sirko-pages"),navigator.serviceWorker.register("sirko_sw.js"),navigator.serviceWorker.ready.then(function(r){return e.serviceWorker=r.active,Promise.resolve(e)})}},i={call:function(e){var r=e.request.referrer,t=new RegExp("^http(s)?://"+e.request.domain);return r&&!t.test(r)&&(r=null),e.request.referrer=r,e}},o={call:function(e){var r=e.request,t=new RegExp("^http(s)?://"+r.domain+"(.*)?/");return r.currentPath=r.currentUrl.replace(t,"/"),r.referrer&&(r.referrer=r.referrer.replace(t,"/")),e}},s=window.sessionStorage,c={put:function(e,r){"object"==typeof r&&(r=JSON.stringify(r)),s.setItem(e,r)},pull:function(e){var r=s.getItem(e);if(r)return"{"===r.charAt(0)&&(r=JSON.parse(r)),r},shift:function(e,r){var t=s.getItem(e);t&&s.setItem(r,t)},clear:function(){s.clear()}},a={call:function(e){return c.pull("lastPredictionFor")===e.request.currentPath&&(e.prediction=c.pull("lastPrediction"),e.prediction.cached=!0),e}},u={call:function(e){var r=Array.prototype.slice.call(document.querySelectorAll('link[rel="stylesheet"]')).map(function(e){return e.href});return Array.prototype.slice.call(document.querySelectorAll("script[src]")).forEach(function(e){r.push(e.src)}),e.request.assets=r,e}},l={call:function(e,r){var t=e.request;return new Promise(function(n,i){var o=new MessageChannel;o.port1.onmessage=function(r){r.data.isStateModified&&(t.referrer=null),n(e)},e.serviceWorker.postMessage({referrer:t.referrer,currentUrl:t.currentUrl,domain:t.domain,engineUrl:r.engineUrl},[o.port2])})}},d=function(e){this.engineUrl=e,this.xhr=new XMLHttpRequest};d.prototype.predict=function(e){var r=this;return new Promise(function(t){r._makePrediction(e,t)})},d.prototype._makePrediction=function(e,r){var t=this;this.xhr.withCredentials=!0,this.xhr.open("POST",this.engineUrl),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.onload=function(){r(JSON.parse(t.xhr.response))},this.xhr.send(this._requestBody(e))},d.prototype._requestBody=function(e){var r={current:e.currentPath,assets:e.assets};return e.referrerPath&&(r.referrer=e.referrerPath),JSON.stringify(r)};var p={appendLink:function(e,r){var t=document.createElement("link");t.href=r,t.rel=e,document.head.appendChild(t)}},h={pipes:[t,n,i,l,o,a,u,{call:function(e,r){if(e.prediction)return e;var t=new d(r.engineUrl),n=e.request;return t.predict({currentPath:n.currentPath,referrerPath:n.referrer,assets:n.assets}).then(function(r){return e.prediction=r,Promise.resolve(e)})}},{call:function(e){var r=this,t=e.prediction.path;return t&&caches.open("sirko-pages").then(function(e){r._fetch(e,t)}),e},_fetch:function(e,r){fetch(r,{credentials:"include"}).then(function(t){if(t.ok)return e.put(r,t)})}},{call:function(e){var r=e.prediction,t=e.request;return r.assets&&r.assets.forEach(function(e){t.assets.indexOf(e)>-1||p.appendLink("prefetch",e)}),e}},{call:function(e){return c.shift("lastPrediction","prevPrediction"),c.put("lastPrediction",e.prediction),c.put("lastPredictionFor",e.request.currentPath),e}},{call:function(e){var r,t=c.pull("prevPrediction"),n=e.prediction;return!n.cached&&t&&t.path&&(r=t.path===e.request.currentPath),[n.path,r]}}],call:function(e,r){var t=Promise.resolve({request:e});return this.pipes.forEach(function(e){t=t.then(function(t){return(t=e.call(t,r))?Promise.resolve(t):Promise.reject()})}),t}},f={predict:function(e,r){return r.engineUrl=r.engineUrl+"/predict",h.call(e,r)}},v=window.sirko;if("serviceWorker"in navigator&&v){var w={agent:window.navigator.userAgent,referrer:document.referrer,currentUrl:window.location.href,domain:document.domain},b={};v.q.forEach(function(e){var r=e[0],t=e[1];b[r]=t}),window.sirko=function(e,r){b.prediction&&"predicted"===e?r.apply(this,b.prediction):b[e]=r},f.predict(w,b).then(function(e){b.predicted&&b.predicted.apply(b.predicted,e),b.prediction=e})}}();

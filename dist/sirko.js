!function(){"use strict";var y="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var e,r=(function(e){var r,n,i,o,s,c,a,u,l,d,f,h,p,v,w,g,b,t,P;r=y,n=/iPhone/i,i=/iPod/i,o=/iPad/i,s=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,c=/Android/i,a=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,u=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,l=/Windows Phone/i,d=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,f=/BlackBerry/i,h=/BB10/i,p=/Opera Mini/i,v=/(CriOS|Chrome)(?=.*\bMobile\b)/i,w=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,g=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),b=function(e,r){return e.test(r)},t=function(e){var r=e||navigator.userAgent,t=r.split("[FBAN");if(void 0!==t[1]&&(r=t[0]),void 0!==(t=r.split("Twitter"))[1]&&(r=t[0]),this.apple={phone:b(n,r),ipod:b(i,r),tablet:!b(n,r)&&b(o,r),device:b(n,r)||b(i,r)||b(o,r)},this.amazon={phone:b(a,r),tablet:!b(a,r)&&b(u,r),device:b(a,r)||b(u,r)},this.android={phone:b(a,r)||b(s,r),tablet:!b(a,r)&&!b(s,r)&&(b(u,r)||b(c,r)),device:b(a,r)||b(u,r)||b(s,r)||b(c,r)},this.windows={phone:b(l,r),tablet:b(d,r),device:b(l,r)||b(d,r)},this.other={blackberry:b(f,r),blackberry10:b(h,r),opera:b(p,r),firefox:b(w,r),chrome:b(v,r),device:b(f,r)||b(h,r)||b(p,r)||b(w,r)||b(v,r)},this.seven_inch=b(g,r),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},P=function(){var e=new t;return e.Class=t,e},e.exports&&"undefined"==typeof window?e.exports=t:e.exports&&"undefined"!=typeof window?e.exports=P():r.isMobile=P()}(e={exports:{}},e.exports),e.exports),t={call:function(e){return!new r.Class(e.request.agent).any&&e}},n={call:function(r){return navigator.serviceWorker.register("/sirko_sw.js"),navigator.serviceWorker.ready.then(function(e){return r.serviceWorker=e.active,Promise.resolve(r)})}},i={call:function(e){var r=e.request.referrer,t=new RegExp("^"+e.request.origin);return r&&!t.test(r)&&(r=null),e.request.referrer=r,e}},o={call:function(e){var r=e.request,t=new RegExp("^"+r.origin);return r.currentPath=r.currentUrl.replace(t,""),r.referrer&&(r.referrer=r.referrer.replace(t,"")),e}},s=window.sessionStorage,c=function(e,r){"object"==typeof r&&(r=JSON.stringify(r)),s.setItem(e,r)},a=function(e){var r=s.getItem(e);if(r)return"{"===r.charAt(0)&&(r=JSON.parse(r)),r},u=function(e,r){var t=s.getItem(e);t&&s.setItem(r,t)},l={call:function(e){return a("lastPredictionFor")!==e.request.currentPath&&e}},d="sirko-prefetch",f="sirko-offline",h=function(){Promise.all([caches.open(d),caches.open(f)]).then(function(e){var t=e[0],n=e[1];t.keys().then(function(e){e.forEach(function(r){t.match(r).then(function(e){return n.put(r,e)}).then(function(){t.delete(r)})})})})},p=function(n,i){caches.open(d).then(function(e){var r,t;r=e,n.forEach(function(e){r.add(new Request(e.path,{credentials:"include",redirect:"follow"}))}),t=e,i.forEach(function(e){t.add(e)})})},v=function(){return caches.delete(d)};var w={call:function(e,r){return r.offline?h():v(),e}},g={call:function(e,r){var t=[];return P(document.querySelectorAll('link[rel="stylesheet"]'),t,"href"),P(document.querySelectorAll("script[src]"),t),r.imagesSelector&&P(document.querySelectorAll(r.imagesSelector),t),e.request.assets=t,e}},b=new RegExp("^http(s)?://");function P(e,t,n){void 0===n&&(n="src"),Array.prototype.slice.call(e).forEach(function(e){var r;r=e[n],b.test(r)&&t.push(e[n])})}var m={call:function(n,i){var o=n.request;return new Promise(function(r,e){var t=new MessageChannel;t.port1.onmessage=function(e){e.data.isStateModified&&(o.referrer=null),r(n)},n.serviceWorker.postMessage({referrer:o.referrer,currentUrl:o.currentUrl,origin:o.origin,engineUrl:i.engineUrl},[t.port2])})}},A=function(e){this.engineUrl=e,this.xhr=new XMLHttpRequest};A.prototype.predict=function(r){var t=this;return new Promise(function(e){t._makePrediction(r,e)})},A.prototype._makePrediction=function(e,r){var t=this;this.xhr.withCredentials=!0,this.xhr.open("POST",this.engineUrl),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.onload=function(){r(JSON.parse(t.xhr.response))},this.xhr.send(this._requestBody(e))},A.prototype._requestBody=function(e){var r={current:e.currentPath,assets:e.assets};return e.referrerPath&&(r.referrer=e.referrerPath),JSON.stringify(r)};var x={pipes:[t,n,i,m,o,l,w,g,{call:function(r,e){if(r.prediction)return r;var t=new A(e.engineUrl),n=r.request;return t.predict({currentPath:n.currentPath,referrerPath:n.referrer,assets:n.assets}).then(function(e){return r.prediction=e,Promise.resolve(r)})}},{call:function(e){var r=e.prediction.pages,t=e.prediction.assets;return r.length&&p(r,t),e}},{call:function(e){return u("lastPrediction","prevPrediction"),c("lastPrediction",e.prediction),c("lastPredictionFor",e.request.currentPath),e}},{call:function(r){var e,t=a("prevPrediction"),n=r.prediction;return t&&t.pages.length&&(e=-1<t.pages.findIndex(function(e){return e.path===r.request.currentPath})),[n.pages,e]}}],call:function(e,t){var n=Promise.resolve({request:e});return this.pipes.forEach(function(r){n=n.then(function(e){return(e=r.call(e,t))?Promise.resolve(e):Promise.reject()})}),n}},q=function(e,r){return r.engineUrl=r.engineUrl+"/predict",x.call(e,r)},S=window.sirko;if("serviceWorker"in navigator&&S){var k={agent:window.navigator.userAgent,referrer:document.referrer,currentUrl:window.location.href,origin:window.location.origin},F={};S.q.forEach(function(e){var r=e[0],t=e[1];F[r]=t}),window.sirko=function(e,r){F.prediction&&"predicted"===e?r.apply(this,F.prediction):F[e]=r},q(k,F).then(function(e){try{var r=F.predicted;r&&r.apply(r,e),F.prediction=e}catch(e){console.error(e)}}).catch(function(){var e=F.rejected;e&&e.apply(e)})}}();

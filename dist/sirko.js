!function(){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var r,t=(function(r){var t,n,i,o,s,c,a,u,l,f,d,h,p,v,w,g,b,P,y;t=e,n=/iPhone/i,i=/iPod/i,o=/iPad/i,s=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,c=/Android/i,a=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,u=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,l=/Windows Phone/i,f=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,d=/BlackBerry/i,h=/BB10/i,p=/Opera Mini/i,v=/(CriOS|Chrome)(?=.*\bMobile\b)/i,w=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,g=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),b=function(e,r){return e.test(r)},P=function(e){var r=e||navigator.userAgent,t=r.split("[FBAN");if(void 0!==t[1]&&(r=t[0]),void 0!==(t=r.split("Twitter"))[1]&&(r=t[0]),this.apple={phone:b(n,r),ipod:b(i,r),tablet:!b(n,r)&&b(o,r),device:b(n,r)||b(i,r)||b(o,r)},this.amazon={phone:b(a,r),tablet:!b(a,r)&&b(u,r),device:b(a,r)||b(u,r)},this.android={phone:b(a,r)||b(s,r),tablet:!b(a,r)&&!b(s,r)&&(b(u,r)||b(c,r)),device:b(a,r)||b(u,r)||b(s,r)||b(c,r)},this.windows={phone:b(l,r),tablet:b(f,r),device:b(l,r)||b(f,r)},this.other={blackberry:b(d,r),blackberry10:b(h,r),opera:b(p,r),firefox:b(w,r),chrome:b(v,r),device:b(d,r)||b(h,r)||b(p,r)||b(w,r)||b(v,r)},this.seven_inch=b(g,r),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},y=function(){var e=new P;return e.Class=P,e},r.exports&&"undefined"==typeof window?r.exports=P:r.exports&&"undefined"!=typeof window?r.exports=y():t.isMobile=y()}(r={exports:{}},r.exports),r.exports),n={call:function(e){return!new t.Class(e.request.agent).any&&e}},i={call:function(e){return navigator.serviceWorker.register("sirko_sw.js"),navigator.serviceWorker.ready.then(function(r){return e.serviceWorker=r.active,Promise.resolve(e)})}},o={call:function(e){var r=e.request.referrer,t=new RegExp("^"+e.request.origin);return r&&!t.test(r)&&(r=null),e.request.referrer=r,e}},s={call:function(e){var r=e.request,t=new RegExp("^"+r.origin);return r.currentPath=r.currentUrl.replace(t,""),r.referrer&&(r.referrer=r.referrer.replace(t,"")),e}},c=window.sessionStorage,a=function(e,r){"object"==typeof r&&(r=JSON.stringify(r)),c.setItem(e,r)},u=function(e){var r=c.getItem(e);if(r)return"{"===r.charAt(0)&&(r=JSON.parse(r)),r},l=function(e,r){var t=c.getItem(e);t&&c.setItem(r,t)},f={call:function(e){return u("lastPredictionFor")!==e.request.currentPath&&e}},d=function(){Promise.all([caches.open("sirko-prefetch"),caches.open("sirko-offline")]).then(function(e){var r=e[0],t=e[1];r.keys().then(function(e){e.forEach(function(e){r.match(e).then(function(r){return t.put(e,r)}).then(function(){r.delete(e)})})})})},h=function(e,r){caches.open("sirko-prefetch").then(function(t){!function(e,r){r.forEach(function(r){e.add(new Request(r.path,{credentials:"include",redirect:"follow"}))})}(t,e),function(e,r){r.forEach(function(r){e.add(r)})}(t,r)})},p=function(){return caches.delete("sirko-prefetch")};var v={call:function(e,r){return r.offline?d():p(),e}},w={call:function(e){var r=[];return Array.prototype.slice.call(document.querySelectorAll('link[rel="stylesheet"]')).forEach(function(e){b(e.href)&&r.push(e.href)}),Array.prototype.slice.call(document.querySelectorAll("script[src]")).forEach(function(e){b(e.src)&&r.push(e.src)}),e.request.assets=r,e}},g=new RegExp("^http(s)?://");function b(e){return g.test(e)}var P={call:function(e,r){var t=e.request;return new Promise(function(n,i){var o=new MessageChannel;o.port1.onmessage=function(r){r.data.isStateModified&&(t.referrer=null),n(e)},e.serviceWorker.postMessage({referrer:t.referrer,currentUrl:t.currentUrl,origin:t.origin,engineUrl:r.engineUrl},[o.port2])})}},y=function(e){this.engineUrl=e,this.xhr=new XMLHttpRequest};y.prototype.predict=function(e){var r=this;return new Promise(function(t){r._makePrediction(e,t)})},y.prototype._makePrediction=function(e,r){var t=this;this.xhr.withCredentials=!0,this.xhr.open("POST",this.engineUrl),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.onload=function(){r(JSON.parse(t.xhr.response))},this.xhr.send(this._requestBody(e))},y.prototype._requestBody=function(e){var r={current:e.currentPath,assets:e.assets};return e.referrerPath&&(r.referrer=e.referrerPath),JSON.stringify(r)};var A={pipes:[n,i,o,P,s,f,v,w,{call:function(e,r){if(e.prediction)return e;var t=new y(r.engineUrl),n=e.request;return t.predict({currentPath:n.currentPath,referrerPath:n.referrer,assets:n.assets}).then(function(r){return e.prediction=r,Promise.resolve(e)})}},{call:function(e){var r=e.prediction.pages,t=e.prediction.assets;return r.length&&h(r,t),e}},{call:function(e){return l("lastPrediction","prevPrediction"),a("lastPrediction",e.prediction),a("lastPredictionFor",e.request.currentPath),e}},{call:function(e){var r,t=u("prevPrediction"),n=e.prediction;return t&&t.pages.length&&(r=t.pages.findIndex(function(r){return r.path===e.request.currentPath})>-1),[n.pages,r]}}],call:function(e,r){var t=Promise.resolve({request:e});return this.pipes.forEach(function(e){t=t.then(function(t){return(t=e.call(t,r))?Promise.resolve(t):Promise.reject()})}),t}},m=function(e,r){return r.engineUrl=r.engineUrl+"/predict",A.call(e,r)},x=window.sirko;if("serviceWorker"in navigator&&x){var k={agent:window.navigator.userAgent,referrer:document.referrer,currentUrl:window.location.href,origin:window.location.origin},q={};x.q.forEach(function(e){var r=e[0],t=e[1];q[r]=t}),window.sirko=function(e,r){q.prediction&&"predicted"===e?r.apply(this,q.prediction):q[e]=r},m(k,q).then(function(e){try{var r=q.predicted;r&&r.apply(r,e),q.prediction=e}catch(e){console.error(e)}}).catch(function(){var e=q.rejected;e&&e.apply(e)})}}();

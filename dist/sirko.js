!function(){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(t){!function(e){var r=/iPhone/i,i=/iPod/i,n=/iPad/i,o=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,s=/Android/i,c=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,a=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,u=/Windows Phone/i,d=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,p=/BlackBerry/i,l=/BB10/i,h=/Opera Mini/i,f=/(CriOS|Chrome)(?=.*\bMobile\b)/i,v=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,b=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),w=function(e,t){return e.test(t)},P=function(e){var t=e||navigator.userAgent,P=t.split("[FBAN");if(void 0!==P[1]&&(t=P[0]),void 0!==(P=t.split("Twitter"))[1]&&(t=P[0]),this.apple={phone:w(r,t),ipod:w(i,t),tablet:!w(r,t)&&w(n,t),device:w(r,t)||w(i,t)||w(n,t)},this.amazon={phone:w(c,t),tablet:!w(c,t)&&w(a,t),device:w(c,t)||w(a,t)},this.android={phone:w(c,t)||w(o,t),tablet:!w(c,t)&&!w(o,t)&&(w(a,t)||w(s,t)),device:w(c,t)||w(a,t)||w(o,t)||w(s,t)},this.windows={phone:w(u,t),tablet:w(d,t),device:w(u,t)||w(d,t)},this.other={blackberry:w(p,t),blackberry10:w(l,t),opera:w(h,t),firefox:w(v,t),chrome:w(f,t),device:w(p,t)||w(l,t)||w(h,t)||w(v,t)||w(f,t)},this.seven_inch=w(b,t),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},y=function(){var e=new P;return e.Class=P,e};t.exports&&"undefined"==typeof window?t.exports=P:t.exports&&"undefined"!=typeof window?t.exports=y():e.isMobile=y()}(e)}),r={call:function(e){return!new t.Class(e.request.agent).any&&e}},i={call:function(e){return"serviceWorker"in navigator&&(navigator.serviceWorker.register("sirko_sw.js"),caches.delete("sirko-pages")),e}},n={call:function(e){var t=e.request.referrer,r=new RegExp("^http(s)?://"+e.request.domain);return t&&!r.test(t)&&(t=null),e.request.referrer=t,e}},o={call:function(e){var t=e.request,r=new RegExp("^http(s)?://"+t.domain+"(.*)?/");return t.currentPath=t.currentPath.replace(r,"/"),t.referrer&&(t.referrer=t.referrer.replace(r,"/")),e}},s=window.sessionStorage,c={put:function(e,t){"object"==typeof t&&(t=JSON.stringify(t)),s.setItem(e,t)},pull:function(e){var t=s.getItem(e);if(t)return"{"===t.charAt(0)&&(t=JSON.parse(t)),t},shift:function(e,t){var r=s.getItem(e);r&&s.setItem(t,r)},clear:function(){s.clear()}},a={call:function(e){return c.pull("lastPredictionFor")===e.request.currentPath&&(e.prediction=c.pull("lastPrediction"),e.prediction.cached=!0),e}},u={call:function(e){var t=Array.prototype.slice.call(document.querySelectorAll('link[rel="stylesheet"]')).map(function(e){return e.href});return Array.prototype.slice.call(document.querySelectorAll("script[src]")).forEach(function(e){t.push(e.src)}),e.request.assets=t,e}},d=function(e){this.engineUrl=e,this.xhr=new XMLHttpRequest};d.prototype.predict=function(e){var t=this;return new Promise(function(r){t._makePrediction(e,r)})},d.prototype._makePrediction=function(e,t){var r=this;this.xhr.withCredentials=!0,this.xhr.open("POST",this._predictorUrl()),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.onload=function(){t(JSON.parse(r.xhr.response))},this.xhr.send(this._requestBody(e))},d.prototype._predictorUrl=function(){return this.engineUrl+"/predict"},d.prototype._requestBody=function(e){var t={current:e.currentPath,assets:e.assets};return e.referrerPath&&(t.referrer=e.referrerPath),JSON.stringify(t)};var p={appendLink:function(e,t){var r=document.createElement("link");r.href=t,r.rel=e,document.head.appendChild(r)}},l={pipes:[r,i,n,o,a,u,{call:function(e,t){if(e.prediction)return e;var r=new d(t.engineUrl),i=e.request;return r.predict({currentPath:i.currentPath,referrerPath:i.referrer,assets:i.assets}).then(function(t){return e.prediction=t,Promise.resolve(e)})}},{call:function(e){var t=this,r=e.prediction.path;return r&&"serviceWorker"in navigator&&caches.open("sirko-pages").then(function(e){t._fetch(e,r)}),e},_fetch:function(e,t){fetch(t,{credentials:"include"}).then(function(r){if(r.ok)return e.put(t,r)})}},{call:function(e){var t=e.prediction,r=e.request;return t.assets&&t.assets.forEach(function(e){r.assets.indexOf(e)>-1||p.appendLink("prefetch",e)}),e}},{call:function(e){return c.shift("lastPrediction","prevPrediction"),c.put("lastPrediction",e.prediction),c.put("lastPredictionFor",e.request.currentPath),e}},{call:function(e){var t,r=c.pull("prevPrediction"),i=e.prediction;return!i.cached&&r&&r.path&&(t=r.path===e.request.currentPath),[i.path,t]}}],call:function(e,t){var r=Promise.resolve({request:e});return this.pipes.forEach(function(e){r=r.then(function(r){return(r=e.call(r,t))?Promise.resolve(r):Promise.reject()})}),r}},h={predict:function(e,t){return l.call(e,t)}},f=window.sirko;if("undefined"!=typeof Promise&&f){var v={agent:window.navigator.userAgent,referrer:document.referrer,currentPath:window.location.href,domain:document.domain},b={};f.q.forEach(function(e){var t=e[0],r=e[1];b[t]=r}),window.sirko=function(e,t){b.prediction&&"predicted"===e?t.apply(this,b.prediction):b[e]=t},h.predict(v,b).then(function(e){b.predicted&&b.predicted.apply(b.predicted,e),b.prediction=e})}}();
